{% extends 'base.html' %}

{% load static %}
{% load filters_tags %}

{% block title %} {{ source_f.name }} {% endblock %}

{% block style %}
    <link rel="stylesheet" href="{% static "css/source_style.css" %}" />
{% endblock %}

{% block content %}

    <ul class="nav nav-tabs" id="myTab">
        {% for survey in surveys %}
            {% if survey == source_f.survey %}
                {% define "active" as status %}
            {% else %}
                {% define "" as status %}
            {% endif %}
        <li class="nav-item">
            <a href="#survey{{ survey.name }}" class="nav-link {{ status }}" data-toggle="tab">Survey{{ survey.name }}</a>
        </li>
        {% endfor %}
        <li class="nav-item">
            <a href="#aladin" class="nav-link" data-toggle="tab">Aladin</a>
        </li>
    </ul>

    <div class="tab-content">
        {% for survey in surveys %}

            {% if survey == source_f.survey %}
                {% define "fade show active" as status %}
            {% else %}
                {% define "fade" as status %}
            {% endif %}

            <div class="tab-pane {{ status }}" id="survey{{ survey.name }}">

            {% if dup_sources|is_in_survey:survey %}
                {% with dup_sources|is_in_survey:survey as source %}

                <div id = "container" >
                    <div class = "trans_image">
                        {% with source.dup_id|to_str as img_num %}
                            <img src="{% static 'images/trans_'|add:img_num|add:'_e2.png' %}" />
                        {% endwith %}
                    </div>

                    <div class = "light_curve">
                        {% with source.dup_id|to_str as img_num %}
                            <iframe src="{% static 'images/lc_'|add:img_num|add:'_e2.pdf' %}" width="500px" height="410px"></iframe>
                        {% endwith %}
                    </div>

                    <div class = "spectrum">
                        {% with source.dup_id|to_str as img_num %}
                            <iframe src="{% static 'images/spec_'|add:img_num|add:'_e2.pdf' %}" width="500px" height="410px"></iframe>
                        {% endwith %}
                    </div>
                </div>

                <div class="table-source">
                    <table class="table table-bordered table-responsive" >
                      <thead class="thead-dark">
                        <tr>
                           <th>Head</th>
                           <th>Value</th>
                        </tr>
                      </thead>
                      <tbody>
                          {% for field,value in source %}
                            <tr>
                                <td>{{ field }}</td>
                                <td>{{ value }}</td>
                            </tr>
                          {% endfor %}
                      </tbody>
                    </table>
                </div>

                <div class = "comment_section">
                    <form method="post">
                        {% csrf_token %}
                        {% include 'includes/form.html' %}
                        <input type="hidden" name="source_id" value={{ source.pk }}>
                        <button type="submit" class="btn btn-success">Edit</button>
                    </form>
                </div>

                {% endwith %}
            {% endif %}

            </div>

        {% endfor %}
        {% comment %} Testing Aladin Lite {% endcomment %}
        <div class="tab-pane fade" id="aladin">

            <div class="test_aladin">
                {% comment %} Aladin Lite CSS style file {% endcomment %}
                <link rel="stylesheet" href="https://aladin.u-strasbg.fr/AladinLite/api/v2/latest/aladin.min.css" />

                {% comment %} Aladin Lite has a dependency on the jQuery library {% endcomment %}
                <script type="text/javascript" src="https://code.jquery.com/jquery-1.9.1.min.js" charset="utf-8"></script>

                {% comment %} Aladin Lite container at requested dimensions {% endcomment %}
                <div id="aladin-lite-div" style="width:700px;height:400px;"></div>

                <input id="DSS" type="radio" name="survey" value="P/DSS2/color" checked><label for="DSS">DSS color</label>
                <input id="DSS-blue" type="radio" name="survey" value="P/DSS2/blue"><label for="DSS-blue">DSS blue</label>
                <input id="2MASS" type="radio" name="survey" value="P/2MASS/color"><label for="2MASS">2MASS</label>
                <input id="allwise" type="radio" name="survey" value="P/allWISE/color"><label for="allwise">AllWISE</label>
                <input id="glimpse" type="radio" name="survey" value="P/GLIMPSE360"><label for="glimpse">GLIMPSE 360</label>

                {% comment %} Aladin Lite JS code {% endcomment %}
                <script type="text/javascript" src="https://aladin.u-strasbg.fr/AladinLite/api/v2/latest/aladin.min.js" charset="utf-8"></script>

                {% comment %} Creation of Aladin Lite instance with initial parameters {% endcomment %}
                <script type="text/javascript" src="{% static "js/aladin_img.js" %}"></script>
            </div>

        </div>

    </div>

{% endblock %}